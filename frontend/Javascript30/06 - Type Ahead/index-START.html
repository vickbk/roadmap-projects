<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Type Ahead ðŸ‘€</title>
    <link rel="stylesheet" href="style.css" />
    <link rel="icon" href="https://fav.farm/ðŸ”¥" />
  </head>
  <body>
    <form class="search-form">
      <input type="text" class="search" placeholder="City or State" />
      <ul class="suggestions">
        <li>Filter for a city</li>
        <li>or a state</li>
      </ul>
    </form>
    <script>
      const endpoint =
        "https://gist.githubusercontent.com/Miserlou/c5cd8364bf9b2420bb29/raw/2bf258763cdddd704f8ffd3ea9a3e81d25e2c6f6/cities.json";
      const cities = [];
      const suggestions = document.querySelector(".suggestions");
      fetch(endpoint)
        .then((blob) => blob.json())
        .then((data) => cities.push(...data));
      function filterCities() {
        const search = new RegExp(this.value, "gi");
        const selectedList = cities.filter(
          ({ city, state }) => city.match(search) || state.match(search)
        );
        showCities(selectedList, this.value);
      }
      function showCities(citiesList, search) {
        let texts = citiesList.map(({ city, state, population }) => {
          const cityHilighted = city.replace(
            new RegExp(search, "gi"),
            `<span class="hl">${search}</span>`
          );
          const stateHilighted = state.replace(
            new RegExp(search, "gi"),
            `<span class="hl">${search}</span>`
          );
          return `<li>
              <span class="name"> ${cityHilighted}, ${stateHilighted}</span>
              <span class="population">${numberWithCommas(population)}</span>
            </li>
            `;
        });
        if (suggestions) suggestions.innerHTML = texts.join("");
      }
      function numberWithCommas(x) {
        const parts = x.toString().split(".");
        parts[0] = parts[0].replace(/\B(?=(\d{3})+(?!\d))/g, ",");
        return parts.join(".");
      }
      const search = document.querySelector("input");
      search.addEventListener("keydown", filterCities);
    </script>
  </body>
</html>
